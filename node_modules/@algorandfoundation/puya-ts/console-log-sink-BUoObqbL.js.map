{"version":3,"file":"console-log-sink-BUoObqbL.js","sources":["../src/logger/sinks/console-log-sink.ts"],"sourcesContent":["import chalk from 'chalk'\nimport type { SourceLocation } from '../../awst/source-location'\nimport type { LogEvent } from '../index'\nimport { isMinLevel, LoggingContext, LogLevel } from '../index'\nimport type { LogSink } from './index'\n\ntype ColorFn = (text: string) => string\nconst levelConfig: Record<LogEvent['level'], { colorFn: ColorFn; writeFn: (...args: unknown[]) => void }> = {\n  /* eslint-disable no-console */\n  debug: { colorFn: chalk.green, writeFn: console.debug },\n  info: { colorFn: chalk.green, writeFn: console.info },\n  warning: { colorFn: chalk.yellow, writeFn: console.warn },\n  error: { colorFn: chalk.red, writeFn: console.error },\n  critical: { colorFn: chalk.red, writeFn: console.error },\n  /* eslint-enable no-console */\n}\n\nexport class ConsoleLogSink implements LogSink {\n  constructor(public readonly minLogLevel: LogLevel) {}\n\n  add(logEvent: LogEvent): void {\n    const config = levelConfig[logEvent.level]\n\n    let logText = `${config.colorFn(logEvent.level)}: ${logEvent.message}`\n    if (logEvent.sourceLocation) {\n      const sourceLocationText = logEvent.sourceLocation.toString()\n      const indentSize = sourceLocationText.length + logEvent.level.length + 4\n\n      const sourceSummary = isMinLevel(logEvent.level, LogLevel.Warning) ? this.getSourceSummary(logEvent.sourceLocation, indentSize) : ''\n      logText = `${sourceLocationText} ${logText}${sourceSummary}`\n    }\n    config.writeFn(logText)\n  }\n\n  getSourceSummary(sourceLocation: SourceLocation, indent: number): string {\n    const sourceFile = sourceLocation.file && LoggingContext.current.sourcesByPath[sourceLocation.file]\n    if (!sourceFile || sourceLocation.scope === 'file') return ''\n\n    const line = sourceFile[sourceLocation.line - 1]\n    const trimmedLine = line.trimStart()\n    const marker = `${''.padStart(sourceLocation.column - (line.length - trimmedLine.length))}^${''.padStart(Math.max(sourceLocation.endColumn - sourceLocation.column - 1, 0), '~')}`\n    const indentChars = ''.padStart(indent, ' ')\n    return `\\n${indentChars}${trimmedLine}\\n${indentChars}${marker}`\n  }\n}\n"],"names":[],"mappings":";;;AAOA,MAAM,WAAW,GAA2F;;AAE1G,IAAA,KAAK,EAAE,EAAE,OAAO,EAAE,KAAK,CAAC,KAAK,EAAE,OAAO,EAAE,OAAO,CAAC,KAAK,EAAE;AACvD,IAAA,IAAI,EAAE,EAAE,OAAO,EAAE,KAAK,CAAC,KAAK,EAAE,OAAO,EAAE,OAAO,CAAC,IAAI,EAAE;AACrD,IAAA,OAAO,EAAE,EAAE,OAAO,EAAE,KAAK,CAAC,MAAM,EAAE,OAAO,EAAE,OAAO,CAAC,IAAI,EAAE;AACzD,IAAA,KAAK,EAAE,EAAE,OAAO,EAAE,KAAK,CAAC,GAAG,EAAE,OAAO,EAAE,OAAO,CAAC,KAAK,EAAE;AACrD,IAAA,QAAQ,EAAE,EAAE,OAAO,EAAE,KAAK,CAAC,GAAG,EAAE,OAAO,EAAE,OAAO,CAAC,KAAK,EAAE;;CAEzD;MAEY,cAAc,CAAA;AACG,IAAA,WAAA;AAA5B,IAAA,WAAA,CAA4B,WAAqB,EAAA;QAArB,IAAW,CAAA,WAAA,GAAX,WAAW;;AAEvC,IAAA,GAAG,CAAC,QAAkB,EAAA;QACpB,MAAM,MAAM,GAAG,WAAW,CAAC,QAAQ,CAAC,KAAK,CAAC;AAE1C,QAAA,IAAI,OAAO,GAAG,CAAA,EAAG,MAAM,CAAC,OAAO,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAK,EAAA,EAAA,QAAQ,CAAC,OAAO,EAAE;AACtE,QAAA,IAAI,QAAQ,CAAC,cAAc,EAAE;YAC3B,MAAM,kBAAkB,GAAG,QAAQ,CAAC,cAAc,CAAC,QAAQ,EAAE;AAC7D,YAAA,MAAM,UAAU,GAAG,kBAAkB,CAAC,MAAM,GAAG,QAAQ,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC;AAExE,YAAA,MAAM,aAAa,GAAG,UAAU,CAAC,QAAQ,CAAC,KAAK,EAAE,QAAQ,CAAC,OAAO,CAAC,GAAG,IAAI,CAAC,gBAAgB,CAAC,QAAQ,CAAC,cAAc,EAAE,UAAU,CAAC,GAAG,EAAE;YACpI,OAAO,GAAG,GAAG,kBAAkB,CAAA,CAAA,EAAI,OAAO,CAAG,EAAA,aAAa,EAAE;;AAE9D,QAAA,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC;;IAGzB,gBAAgB,CAAC,cAA8B,EAAE,MAAc,EAAA;AAC7D,QAAA,MAAM,UAAU,GAAG,cAAc,CAAC,IAAI,IAAI,cAAc,CAAC,OAAO,CAAC,aAAa,CAAC,cAAc,CAAC,IAAI,CAAC;AACnG,QAAA,IAAI,CAAC,UAAU,IAAI,cAAc,CAAC,KAAK,KAAK,MAAM;AAAE,YAAA,OAAO,EAAE;QAE7D,MAAM,IAAI,GAAG,UAAU,CAAC,cAAc,CAAC,IAAI,GAAG,CAAC,CAAC;AAChD,QAAA,MAAM,WAAW,GAAG,IAAI,CAAC,SAAS,EAAE;QACpC,MAAM,MAAM,GAAG,CAAG,EAAA,EAAE,CAAC,QAAQ,CAAC,cAAc,CAAC,MAAM,IAAI,IAAI,CAAC,MAAM,GAAG,WAAW,CAAC,MAAM,CAAC,CAAC,CAAI,CAAA,EAAA,EAAE,CAAC,QAAQ,CAAC,IAAI,CAAC,GAAG,CAAC,cAAc,CAAC,SAAS,GAAG,cAAc,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC,CAAC,EAAE,GAAG,CAAC,CAAA,CAAE;QAClL,MAAM,WAAW,GAAG,EAAE,CAAC,QAAQ,CAAC,MAAM,EAAE,GAAG,CAAC;QAC5C,OAAO,CAAA,EAAA,EAAK,WAAW,CAAG,EAAA,WAAW,KAAK,WAAW,CAAA,EAAG,MAAM,CAAA,CAAE;;AAEnE;;;;"}